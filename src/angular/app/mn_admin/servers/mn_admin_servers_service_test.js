describe("mnAdminServersService", function () {
  var $httpBackend;
  var $timeout;
  var mnAdminServersService;

  beforeEach(angular.mock.module('mnAdminServersService'));
  beforeEach(inject(function ($injector) {
    $timeout = $injector.get('$timeout');
    $httpBackend = $injector.get('$httpBackend');
    mnAdminServersService = $injector.get('mnAdminServersService');
  }));

  it('should be properly initialized', function () {
    expect(mnAdminServersService.populatePerNodeRepalanceProgress).toEqual(jasmine.any(Function));
    expect(mnAdminServersService.populateFailoverWarningsModel).toEqual(jasmine.any(Function));
    expect(mnAdminServersService.populateNodesModel).toEqual(jasmine.any(Function));
    expect(mnAdminServersService.populateFailoverWarningsModel).toEqual(jasmine.any(Function));
    expect(mnAdminServersService.populateRebalanceModel).toEqual(jasmine.any(Function));
    expect(mnAdminServersService.onStopRebalance).toEqual(jasmine.any(Function));
    expect(mnAdminServersService.postAndReload).toEqual(jasmine.any(Function));
    expect(mnAdminServersService.model).toEqual(jasmine.any(Object));
  });

  it('should properly send requests', function () {
    $httpBackend.expectPOST('/test').respond(200);
    mnAdminServersService.onStopRebalance('/test');
    $httpBackend.flush();

    $httpBackend.expectPOST('/test', 'otpNode=otpNode1+%40+%25', {"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","Accept":"application/json, text/plain, */*"}).respond(200);
    mnAdminServersService.postAndReload('/test', {otpNode: 'otpNode1 @ %'});
    $httpBackend.flush();

    $httpBackend.expectPOST('/test').respond(200);
    mnAdminServersService.postAndReload('/test');
    $httpBackend.flush();
  });

  it('should popuplate per node rebalance progress model', function () {
    var deps = {"progress":{"type":"rebalance","subtype":"rebalance","recommendedRefreshPeriod":0.25,"status":"running","progress":52.14007782101167,"perNode":{"n_1@0.0.0.0":{"progress":100},"n_0@192.168.1.102":{"progress":4.280155642023342}},"detailedProgress":{"bucket":"default","bucketNumber":1,"bucketsCount":1,"perNode":{"n_1@0.0.0.0":{"ingoing":{"docsTotal":0,"docsTransferred":0,"activeVBucketsLeft":0,"replicaVBucketsLeft":492},"outgoing":{"docsTotal":0,"docsTransferred":0,"activeVBucketsLeft":0,"replicaVBucketsLeft":0}},"n_0@192.168.1.102":{"ingoing":{"docsTotal":0,"docsTransferred":0,"activeVBucketsLeft":0,"replicaVBucketsLeft":0},"outgoing":{"docsTotal":0,"docsTransferred":0,"activeVBucketsLeft":0,"replicaVBucketsLeft":0}}}}},"nodes":[{"systemStats":{"cpu_utilization_rate":77.72277227722772,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":3339407360},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":12035411,"couch_docs_data_size":10946560,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":33757800,"ops":0,"vb_replica_curr_items":0},"uptime":"1622","memoryTotal":6191300608,"memoryFree":3339407360,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://192.168.1.102:9500/","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_0@192.168.1.102","thisNode":true,"hostname":"192.168.1.102:9000","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12001,"direct":12000},"group":"Group 1","rebalanceProgressPercent":3.5},{"systemStats":{"cpu_utilization_rate":96.93877551020408,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":3320651776},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":5317154,"couch_docs_data_size":4393708,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":18307208,"ops":0,"vb_replica_curr_items":0},"uptime":"1623","memoryTotal":6191300608,"memoryFree":3320651776,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://0.0.0.0:9501/","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_1@0.0.0.0","hostname":"0.0.0.0:9001","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12003,"direct":12002},"group":"Group 1","rebalanceProgressPercent":100}]};
    mnAdminServersService.populatePerNodeRepalanceProgress(deps);
    expect(deps.nodes[0].rebalanceProgressPercent).toBe(4.28);
    expect(deps.nodes[1].rebalanceProgressPercent).toBe(100);

    deps = {"progress":{"type":"rebalance","subtype":"rebalance","recommendedRefreshPeriod":0.25,"status":"notRunning","progress":52.14007782101167,"perNode":{"n_1@0.0.0.0":{"progress":100},"n_0@192.168.1.102":{"progress":4.280155642023342}},"detailedProgress":{"bucket":"default","bucketNumber":1,"bucketsCount":1,"perNode":{"n_1@0.0.0.0":{"ingoing":{"docsTotal":0,"docsTransferred":0,"activeVBucketsLeft":0,"replicaVBucketsLeft":492},"outgoing":{"docsTotal":0,"docsTransferred":0,"activeVBucketsLeft":0,"replicaVBucketsLeft":0}},"n_0@192.168.1.102":{"ingoing":{"docsTotal":0,"docsTransferred":0,"activeVBucketsLeft":0,"replicaVBucketsLeft":0},"outgoing":{"docsTotal":0,"docsTransferred":0,"activeVBucketsLeft":0,"replicaVBucketsLeft":0}}}}},"nodes":[{"systemStats":{"cpu_utilization_rate":77.72277227722772,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":3339407360},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":12035411,"couch_docs_data_size":10946560,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":33757800,"ops":0,"vb_replica_curr_items":0},"uptime":"1622","memoryTotal":6191300608,"memoryFree":3339407360,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://192.168.1.102:9500/","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_0@192.168.1.102","thisNode":true,"hostname":"192.168.1.102:9000","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12001,"direct":12000},"group":"Group 1","rebalanceProgressPercent":3.5},{"systemStats":{"cpu_utilization_rate":96.93877551020408,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":3320651776},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":5317154,"couch_docs_data_size":4393708,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":18307208,"ops":0,"vb_replica_curr_items":0},"uptime":"1623","memoryTotal":6191300608,"memoryFree":3320651776,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://0.0.0.0:9501/","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_1@0.0.0.0","hostname":"0.0.0.0:9001","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12003,"direct":12002},"group":"Group 1","rebalanceProgressPercent":100}]};
    mnAdminServersService.populatePerNodeRepalanceProgress(deps);
    expect(deps.nodes[0].rebalanceProgressPercent).toBe(0);
    expect(deps.nodes[1].rebalanceProgressPercent).toBe(0);

    deps = {"nodes":[{"systemStats":{"cpu_utilization_rate":77.72277227722772,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":3339407360},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":12035411,"couch_docs_data_size":10946560,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":33757800,"ops":0,"vb_replica_curr_items":0},"uptime":"1622","memoryTotal":6191300608,"memoryFree":3339407360,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://192.168.1.102:9500/","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_0@192.168.1.102","thisNode":true,"hostname":"192.168.1.102:9000","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12001,"direct":12000},"group":"Group 1","rebalanceProgressPercent":3.5},{"systemStats":{"cpu_utilization_rate":96.93877551020408,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":3320651776},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":5317154,"couch_docs_data_size":4393708,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":18307208,"ops":0,"vb_replica_curr_items":0},"uptime":"1623","memoryTotal":6191300608,"memoryFree":3320651776,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://0.0.0.0:9501/","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_1@0.0.0.0","hostname":"0.0.0.0:9001","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12003,"direct":12002},"group":"Group 1","rebalanceProgressPercent":100}]};
    mnAdminServersService.populatePerNodeRepalanceProgress(deps);
    expect(deps.nodes[0].rebalanceProgressPercent).toBe(0);
    expect(deps.nodes[1].rebalanceProgressPercent).toBe(0);
  });

  it('should populate nodes model', function () {
    var deps = {"isGroupsAvailable":"/pools/default/serverGroups?v=73762832","hostnameToGroup":{"192.168.1.102:9000":{"name":"Group 1","uri":"/pools/default/serverGroups/0","addNodeURI":"/pools/default/serverGroups/0/addNode","nodes":[{"systemStats":{"cpu_utilization_rate":46.03960396039604,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2918858752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":13400610,"couch_docs_data_size":10999808,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34350472,"ops":0,"vb_replica_curr_items":0},"uptime":"3222","memoryTotal":6191300608,"memoryFree":2918858752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://192.168.1.102:9500/","otpCookie":"pczruiiulzactcwg","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_0@192.168.1.102","thisNode":true,"hostname":"192.168.1.102:9000","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12001,"direct":12000}}]},"0.0.0.0:9001":{"name":"Group 1","uri":"/pools/default/serverGroups/0","addNodeURI":"/pools/default/serverGroups/0/addNode","nodes":[{"systemStats":{"cpu_utilization_rate":46.03960396039604,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2918858752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":13400610,"couch_docs_data_size":10999808,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34350472,"ops":0,"vb_replica_curr_items":0},"uptime":"3222","memoryTotal":6191300608,"memoryFree":2918858752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://192.168.1.102:9500/","otpCookie":"pczruiiulzactcwg","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_0@192.168.1.102","thisNode":true,"hostname":"192.168.1.102:9000","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12001,"direct":12000}}]}},"nodes":[{"systemStats":{"cpu_utilization_rate":46.03960396039604,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2918858752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":13400610,"couch_docs_data_size":10999808,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34350472,"ops":0,"vb_replica_curr_items":0},"uptime":"3222","memoryTotal":6191300608,"memoryFree":2918858752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://192.168.1.102:9500/","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_0@192.168.1.102","thisNode":true,"hostname":"192.168.1.102:9000","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12001,"direct":12000}}, {"systemStats":{"cpu_utilization_rate":43,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2922954752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":9169318,"couch_docs_data_size":6768640,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34329928,"ops":0,"vb_replica_curr_items":0},"uptime":"3223","memoryTotal":6191300608,"memoryFree":2922954752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://0.0.0.0:9501/","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_1@0.0.0.0","hostname":"0.0.0.0:9001","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12003,"direct":12002}}],"pendingEjectLength":1,"pendingEject":[{"systemStats":{"cpu_utilization_rate":43,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2922954752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":9169318,"couch_docs_data_size":6768640,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34329928,"ops":0,"vb_replica_curr_items":0},"uptime":"3223","memoryTotal":6191300608,"memoryFree":2922954752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://0.0.0.0:9501/","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_1@0.0.0.0","hostname":"0.0.0.0:9001","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12003,"direct":12002},"group":"Group 1","pendingEject":true}]};
    deps.isGroupsAvailable = true;
    mnAdminServersService.populateNodesModel(deps);

    expect(mnAdminService.model.nodes).toEqual({ allNodes : [ { systemStats : { cpu_utilization_rate : 46.03960396039604, swap_total : 6291451904, swap_used : 0, mem_total : 6191300608, mem_free : 2918858752 }, interestingStats : { cmd_get : 0, couch_docs_actual_disk_size : 13400610, couch_docs_data_size : 10999808, couch_views_actual_disk_size : 0, couch_views_data_size : 0, curr_items : 0, curr_items_tot : 0, ep_bg_fetched : 0, get_hits : 0, mem_used : 34350472, ops : 0, vb_replica_curr_items : 0 }, uptime : '3222', memoryTotal : 6191300608, memoryFree : 2918858752, mcdMemoryReserved : 4723, mcdMemoryAllocated : 4723, couchApiBase : 'http://192.168.1.102:9500/', clusterMembership : 'active', recoveryType : 'none', status : 'healthy', otpNode : 'n_0@192.168.1.102', thisNode : true, hostname : '192.168.1.102:9000', clusterCompatibility : 196608, version : '3.0.0r-902-g3d88063', os : 'x86_64-pc-linux-gnu', ports : { proxy : 12001, direct : 12000 }, group : 'Group 1' }, { systemStats : { cpu_utilization_rate : 43, swap_total : 6291451904, swap_used : 0, mem_total : 6191300608, mem_free : 2922954752 }, interestingStats : { cmd_get : 0, couch_docs_actual_disk_size : 9169318, couch_docs_data_size : 6768640, couch_views_actual_disk_size : 0, couch_views_data_size : 0, curr_items : 0, curr_items_tot : 0, ep_bg_fetched : 0, get_hits : 0, mem_used : 34329928, ops : 0, vb_replica_curr_items : 0 }, uptime : '3223', memoryTotal : 6191300608, memoryFree : 2922954752, mcdMemoryReserved : 4723, mcdMemoryAllocated : 4723, couchApiBase : 'http://0.0.0.0:9501/', clusterMembership : 'active', recoveryType : 'none', status : 'healthy', otpNode : 'n_1@0.0.0.0', hostname : '0.0.0.0:9001', clusterCompatibility : 196608, version : '3.0.0r-902-g3d88063', os : 'x86_64-pc-linux-gnu', ports : { proxy : 12003, direct : 12002 }, group : 'Group 1', pendingEject : true } ], failedOver : [  ], onlyActive : [ { systemStats : { cpu_utilization_rate : 46.03960396039604, swap_total : 6291451904, swap_used : 0, mem_total : 6191300608, mem_free : 2918858752 }, interestingStats : { cmd_get : 0, couch_docs_actual_disk_size : 13400610, couch_docs_data_size : 10999808, couch_views_actual_disk_size : 0, couch_views_data_size : 0, curr_items : 0, curr_items_tot : 0, ep_bg_fetched : 0, get_hits : 0, mem_used : 34350472, ops : 0, vb_replica_curr_items : 0 }, uptime : '3222', memoryTotal : 6191300608, memoryFree : 2918858752, mcdMemoryReserved : 4723, mcdMemoryAllocated : 4723, couchApiBase : 'http://192.168.1.102:9500/', clusterMembership : 'active', recoveryType : 'none', status : 'healthy', otpNode : 'n_0@192.168.1.102', thisNode : true, hostname : '192.168.1.102:9000', clusterCompatibility : 196608, version : '3.0.0r-902-g3d88063', os : 'x86_64-pc-linux-gnu', ports : { proxy : 12001, direct : 12000 }, group : 'Group 1' }, { systemStats : { cpu_utilization_rate : 43, swap_total : 6291451904, swap_used : 0, mem_total : 6191300608, mem_free : 2922954752 }, interestingStats : { cmd_get : 0, couch_docs_actual_disk_size : 9169318, couch_docs_data_size : 6768640, couch_views_actual_disk_size : 0, couch_views_data_size : 0, curr_items : 0, curr_items_tot : 0, ep_bg_fetched : 0, get_hits : 0, mem_used : 34329928, ops : 0, vb_replica_curr_items : 0 }, uptime : '3223', memoryTotal : 6191300608, memoryFree : 2922954752, mcdMemoryReserved : 4723, mcdMemoryAllocated : 4723, couchApiBase : 'http://0.0.0.0:9501/', clusterMembership : 'active', recoveryType : 'none', status : 'healthy', otpNode : 'n_1@0.0.0.0', hostname : '0.0.0.0:9001', clusterCompatibility : 196608, version : '3.0.0r-902-g3d88063', os : 'x86_64-pc-linux-gnu', ports : { proxy : 12003, direct : 12002 }, group : 'Group 1', pendingEject : true } ], active : [ { systemStats : { cpu_utilization_rate : 46.03960396039604, swap_total : 6291451904, swap_used : 0, mem_total : 6191300608, mem_free : 2918858752 }, interestingStats : { cmd_get : 0, couch_docs_actual_disk_size : 13400610, couch_docs_data_size : 10999808, couch_views_actual_disk_size : 0, couch_views_data_size : 0, curr_items : 0, curr_items_tot : 0, ep_bg_fetched : 0, get_hits : 0, mem_used : 34350472, ops : 0, vb_replica_curr_items : 0 }, uptime : '3222', memoryTotal : 6191300608, memoryFree : 2918858752, mcdMemoryReserved : 4723, mcdMemoryAllocated : 4723, couchApiBase : 'http://192.168.1.102:9500/', clusterMembership : 'active', recoveryType : 'none', status : 'healthy', otpNode : 'n_0@192.168.1.102', thisNode : true, hostname : '192.168.1.102:9000', clusterCompatibility : 196608, version : '3.0.0r-902-g3d88063', os : 'x86_64-pc-linux-gnu', ports : { proxy : 12001, direct : 12000 }, group : 'Group 1' }, { systemStats : { cpu_utilization_rate : 43, swap_total : 6291451904, swap_used : 0, mem_total : 6191300608, mem_free : 2922954752 }, interestingStats : { cmd_get : 0, couch_docs_actual_disk_size : 9169318, couch_docs_data_size : 6768640, couch_views_actual_disk_size : 0, couch_views_data_size : 0, curr_items : 0, curr_items_tot : 0, ep_bg_fetched : 0, get_hits : 0, mem_used : 34329928, ops : 0, vb_replica_curr_items : 0 }, uptime : '3223', memoryTotal : 6191300608, memoryFree : 2922954752, mcdMemoryReserved : 4723, mcdMemoryAllocated : 4723, couchApiBase : 'http://0.0.0.0:9501/', clusterMembership : 'active', recoveryType : 'none', status : 'healthy', otpNode : 'n_1@0.0.0.0', hostname : '0.0.0.0:9001', clusterCompatibility : 196608, version : '3.0.0r-902-g3d88063', os : 'x86_64-pc-linux-gnu', ports : { proxy : 12003, direct : 12002 }, group : 'Group 1', pendingEject : true } ], down : [  ], pending : [ { systemStats : { cpu_utilization_rate : 43, swap_total : 6291451904, swap_used : 0, mem_total : 6191300608, mem_free : 2922954752 }, interestingStats : { cmd_get : 0, couch_docs_actual_disk_size : 9169318, couch_docs_data_size : 6768640, couch_views_actual_disk_size : 0, couch_views_data_size : 0, curr_items : 0, curr_items_tot : 0, ep_bg_fetched : 0, get_hits : 0, mem_used : 34329928, ops : 0, vb_replica_curr_items : 0 }, uptime : '3223', memoryTotal : 6191300608, memoryFree : 2922954752, mcdMemoryReserved : 4723, mcdMemoryAllocated : 4723, couchApiBase : 'http://0.0.0.0:9501/', clusterMembership : 'active', recoveryType : 'none', status : 'healthy', otpNode : 'n_1@0.0.0.0', hostname : '0.0.0.0:9001', clusterCompatibility : 196608, version : '3.0.0r-902-g3d88063', os : 'x86_64-pc-linux-gnu', ports : { proxy : 12003, direct : 12002 }, group : 'Group 1', pendingEject : true } ], reallyActive : [ { systemStats : { cpu_utilization_rate : 46.03960396039604, swap_total : 6291451904, swap_used : 0, mem_total : 6191300608, mem_free : 2918858752 }, interestingStats : { cmd_get : 0, couch_docs_actual_disk_size : 13400610, couch_docs_data_size : 10999808, couch_views_actual_disk_size : 0, couch_views_data_size : 0, curr_items : 0, curr_items_tot : 0, ep_bg_fetched : 0, get_hits : 0, mem_used : 34350472, ops : 0, vb_replica_curr_items : 0 }, uptime : '3222', memoryTotal : 6191300608, memoryFree : 2918858752, mcdMemoryReserved : 4723, mcdMemoryAllocated : 4723, couchApiBase : 'http://192.168.1.102:9500/', clusterMembership : 'active', recoveryType : 'none', status : 'healthy', otpNode : 'n_0@192.168.1.102', thisNode : true, hostname : '192.168.1.102:9000', clusterCompatibility : 196608, version : '3.0.0r-902-g3d88063', os : 'x86_64-pc-linux-gnu', ports : { proxy : 12001, direct : 12000 }, group : 'Group 1' } ], unhealthyActive : undefined });
    expect(mnAdminService.model.nodes.active[0]).not.toBe(deps.nodes[0]);
    expect(mnAdminService.model.nodes.active[0].group).toEqual('Group 1');

    deps = {"isGroupsAvailable":"/pools/default/serverGroups?v=73762832","hostnameToGroup":{"192.168.1.102:9000":{"name":"Group 1","uri":"/pools/default/serverGroups/0","addNodeURI":"/pools/default/serverGroups/0/addNode","nodes":[{"systemStats":{"cpu_utilization_rate":51.25628140703517,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":3037057024},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":13400610,"couch_docs_data_size":10999808,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34350472,"ops":0,"vb_replica_curr_items":0},"uptime":"2292","memoryTotal":6191300608,"memoryFree":3037057024,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://192.168.1.102:9500/","otpCookie":"pczruiiulzactcwg","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_0@192.168.1.102","thisNode":true,"hostname":"192.168.1.102:9000","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12001,"direct":12000}},{"systemStats":{"cpu_utilization_rate":34.82587064676617,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":3037995008},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":9169318,"couch_docs_data_size":6768640,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34329928,"ops":0,"vb_replica_curr_items":0},"uptime":"2293","memoryTotal":6191300608,"memoryFree":3037995008,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://0.0.0.0:9501/","otpCookie":"pczruiiulzactcwg","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_1@0.0.0.0","hostname":"0.0.0.0:9001","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12003,"direct":12002}}]},"0.0.0.0:9001":{"name":"Group 1","uri":"/pools/default/serverGroups/0","addNodeURI":"/pools/default/serverGroups/0/addNode","nodes":[{"systemStats":{"cpu_utilization_rate":51.25628140703517,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":3037057024},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":13400610,"couch_docs_data_size":10999808,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34350472,"ops":0,"vb_replica_curr_items":0},"uptime":"2292","memoryTotal":6191300608,"memoryFree":3037057024,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://192.168.1.102:9500/","otpCookie":"pczruiiulzactcwg","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_0@192.168.1.102","thisNode":true,"hostname":"192.168.1.102:9000","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12001,"direct":12000}},{"systemStats":{"cpu_utilization_rate":34.82587064676617,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":3037995008},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":9169318,"couch_docs_data_size":6768640,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34329928,"ops":0,"vb_replica_curr_items":0},"uptime":"2293","memoryTotal":6191300608,"memoryFree":3037995008,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://0.0.0.0:9501/","otpCookie":"pczruiiulzactcwg","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_1@0.0.0.0","hostname":"0.0.0.0:9001","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12003,"direct":12002}}]}},"nodes":[{"systemStats":{"cpu_utilization_rate":38.38383838383838,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":3040808960},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":13400610,"couch_docs_data_size":10999808,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34350472,"ops":0,"vb_replica_curr_items":0},"uptime":"2332","memoryTotal":6191300608,"memoryFree":3040808960,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://192.168.1.102:9500/","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_0@192.168.1.102","thisNode":true,"hostname":"192.168.1.102:9000","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12001,"direct":12000}},{"systemStats":{"cpu_utilization_rate":22.05128205128205,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":3039256576},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":9169318,"couch_docs_data_size":6768640,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34329928,"ops":0,"vb_replica_curr_items":0},"uptime":"2333","memoryTotal":6191300608,"memoryFree":3039256576,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://0.0.0.0:9501/","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_1@0.0.0.0","hostname":"0.0.0.0:9001","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12003,"direct":12002}}],"pendingEjectLength":0,"pendingEject":[]};
    deps.isGroupsAvailable = false;
    mnAdminServersService.populateNodesModel(deps);
    expect(mnAdminService.model.nodes.active[0].group).toEqual(undefined);

    deps = {"isGroupsAvailable":"/pools/default/serverGroups?v=73762832","hostnameToGroup":{"192.168.1.102:9000":{"name":"Group 1","uri":"/pools/default/serverGroups/0","addNodeURI":"/pools/default/serverGroups/0/addNode","nodes":[{"systemStats":{"cpu_utilization_rate":46.03960396039604,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2918858752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":13400610,"couch_docs_data_size":10999808,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34350472,"ops":0,"vb_replica_curr_items":0},"uptime":"3222","memoryTotal":6191300608,"memoryFree":2918858752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://192.168.1.102:9500/","otpCookie":"pczruiiulzactcwg","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_0@192.168.1.102","thisNode":true,"hostname":"192.168.1.102:9000","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12001,"direct":12000}}]},"0.0.0.0:9001":{"name":"Group 1","uri":"/pools/default/serverGroups/0","addNodeURI":"/pools/default/serverGroups/0/addNode","nodes":[{"systemStats":{"cpu_utilization_rate":46.03960396039604,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2918858752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":13400610,"couch_docs_data_size":10999808,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34350472,"ops":0,"vb_replica_curr_items":0},"uptime":"3222","memoryTotal":6191300608,"memoryFree":2918858752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://192.168.1.102:9500/","otpCookie":"pczruiiulzactcwg","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_0@192.168.1.102","thisNode":true,"hostname":"192.168.1.102:9000","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12001,"direct":12000}}]}},"nodes":[{"systemStats":{"cpu_utilization_rate":46.03960396039604,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2918858752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":13400610,"couch_docs_data_size":10999808,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34350472,"ops":0,"vb_replica_curr_items":0},"uptime":"3222","memoryTotal":6191300608,"memoryFree":2918858752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://192.168.1.102:9500/","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_0@192.168.1.102","thisNode":true,"hostname":"192.168.1.102:9000","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12001,"direct":12000}}],"pendingEjectLength":1,"pendingEject":[{"systemStats":{"cpu_utilization_rate":43,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2922954752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":9169318,"couch_docs_data_size":6768640,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34329928,"ops":0,"vb_replica_curr_items":0},"uptime":"3223","memoryTotal":6191300608,"memoryFree":2922954752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://0.0.0.0:9501/","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_1@0.0.0.0","hostname":"0.0.0.0:9001","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12003,"direct":12002},"group":"Group 1","pendingEject":true}]};
    mnAdminServersService.populateNodesModel(deps);
    expect(deps.pendingEject).toEqual([]);

    deps = {"isGroupsAvailable":"/pools/default/serverGroups?v=73762832","hostnameToGroup":{"192.168.1.102:9000":{"name":"Group 1","uri":"/pools/default/serverGroups/0","addNodeURI":"/pools/default/serverGroups/0/addNode","nodes":[{"systemStats":{"cpu_utilization_rate":46.03960396039604,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2918858752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":13400610,"couch_docs_data_size":10999808,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34350472,"ops":0,"vb_replica_curr_items":0},"uptime":"3222","memoryTotal":6191300608,"memoryFree":2918858752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://192.168.1.102:9500/","otpCookie":"pczruiiulzactcwg","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_0@192.168.1.102","thisNode":true,"hostname":"192.168.1.102:9000","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12001,"direct":12000}}]},"0.0.0.0:9001":{"name":"Group 1","uri":"/pools/default/serverGroups/0","addNodeURI":"/pools/default/serverGroups/0/addNode","nodes":[{"systemStats":{"cpu_utilization_rate":46.03960396039604,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2918858752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":13400610,"couch_docs_data_size":10999808,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34350472,"ops":0,"vb_replica_curr_items":0},"uptime":"3222","memoryTotal":6191300608,"memoryFree":2918858752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://192.168.1.102:9500/","otpCookie":"pczruiiulzactcwg","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_0@192.168.1.102","thisNode":true,"hostname":"192.168.1.102:9000","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12001,"direct":12000}}]}},"nodes":[{"systemStats":{"cpu_utilization_rate":46.03960396039604,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2918858752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":13400610,"couch_docs_data_size":10999808,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34350472,"ops":0,"vb_replica_curr_items":0},"uptime":"3222","memoryTotal":6191300608,"memoryFree":2918858752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://192.168.1.102:9500/","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_0@192.168.1.102","thisNode":true,"hostname":"192.168.1.102:9000","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12001,"direct":12000}}, {"systemStats":{"cpu_utilization_rate":43,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2922954752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":9169318,"couch_docs_data_size":6768640,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34329928,"ops":0,"vb_replica_curr_items":0},"uptime":"3223","memoryTotal":6191300608,"memoryFree":2922954752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://0.0.0.0:9501/","clusterMembership":"inactiveAdded","recoveryType":"none","status":"healthy","otpNode":"n_1@0.0.0.0","hostname":"0.0.0.0:9001","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12003,"direct":12002}}],"pendingEjectLength":1,"pendingEject":[{"systemStats":{"cpu_utilization_rate":43,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2922954752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":9169318,"couch_docs_data_size":6768640,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34329928,"ops":0,"vb_replica_curr_items":0},"uptime":"3223","memoryTotal":6191300608,"memoryFree":2922954752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://0.0.0.0:9501/","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_1@0.0.0.0","hostname":"0.0.0.0:9001","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12003,"direct":12002},"group":"Group 1","pendingEject":true}]};
    mnAdminServersService.populateNodesModel(deps);
    expect(deps.pendingEject).toEqual([]);

    deps = {"isGroupsAvailable":"/pools/default/serverGroups?v=73762832","hostnameToGroup":{"192.168.1.102:9000":{"name":"Group 1","uri":"/pools/default/serverGroups/0","addNodeURI":"/pools/default/serverGroups/0/addNode","nodes":[{"systemStats":{"cpu_utilization_rate":46.03960396039604,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2918858752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":13400610,"couch_docs_data_size":10999808,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34350472,"ops":0,"vb_replica_curr_items":0},"uptime":"3222","memoryTotal":6191300608,"memoryFree":2918858752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://192.168.1.102:9500/","otpCookie":"pczruiiulzactcwg","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_0@192.168.1.102","thisNode":true,"hostname":"192.168.1.102:9000","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12001,"direct":12000}}]},"0.0.0.0:9001":{"name":"Group 1","uri":"/pools/default/serverGroups/0","addNodeURI":"/pools/default/serverGroups/0/addNode","nodes":[{"systemStats":{"cpu_utilization_rate":46.03960396039604,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2918858752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":13400610,"couch_docs_data_size":10999808,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34350472,"ops":0,"vb_replica_curr_items":0},"uptime":"3222","memoryTotal":6191300608,"memoryFree":2918858752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://192.168.1.102:9500/","otpCookie":"pczruiiulzactcwg","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_0@192.168.1.102","thisNode":true,"hostname":"192.168.1.102:9000","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12001,"direct":12000}}]}},"nodes":[{"systemStats":{"cpu_utilization_rate":46.03960396039604,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2918858752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":13400610,"couch_docs_data_size":10999808,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34350472,"ops":0,"vb_replica_curr_items":0},"uptime":"3222","memoryTotal":6191300608,"memoryFree":2918858752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://192.168.1.102:9500/","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_0@192.168.1.102","thisNode":true,"hostname":"192.168.1.102:9000","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12001,"direct":12000}}, {"systemStats":{"cpu_utilization_rate":43,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2922954752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":9169318,"couch_docs_data_size":6768640,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34329928,"ops":0,"vb_replica_curr_items":0},"uptime":"3223","memoryTotal":6191300608,"memoryFree":2922954752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://0.0.0.0:9501/","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_1@0.0.0.0","hostname":"0.0.0.0:9001","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12003,"direct":12002}}],"pendingEjectLength":1,"pendingEject":[{"systemStats":{"cpu_utilization_rate":43,"swap_total":6291451904,"swap_used":0,"mem_total":6191300608,"mem_free":2922954752},"interestingStats":{"cmd_get":0,"couch_docs_actual_disk_size":9169318,"couch_docs_data_size":6768640,"couch_views_actual_disk_size":0,"couch_views_data_size":0,"curr_items":0,"curr_items_tot":0,"ep_bg_fetched":0,"get_hits":0,"mem_used":34329928,"ops":0,"vb_replica_curr_items":0},"uptime":"3223","memoryTotal":6191300608,"memoryFree":2922954752,"mcdMemoryReserved":4723,"mcdMemoryAllocated":4723,"couchApiBase":"http://0.0.0.0:9501/","clusterMembership":"active","recoveryType":"none","status":"healthy","otpNode":"n_1@0.0.0.0","hostname":"0.0.0.0:9001","clusterCompatibility":196608,"version":"3.0.0r-902-g3d88063","os":"x86_64-pc-linux-gnu","ports":{"proxy":12003,"direct":12002},"group":"Group 1","pendingEject":true}]};
    mnAdminServersService.populateNodesModel(deps);
    expect(deps.pendingEject).toEqual([{ systemStats : { cpu_utilization_rate : 43, swap_total : 6291451904, swap_used : 0, mem_total : 6191300608, mem_free : 2922954752 }, interestingStats : { cmd_get : 0, couch_docs_actual_disk_size : 9169318, couch_docs_data_size : 6768640, couch_views_actual_disk_size : 0, couch_views_data_size : 0, curr_items : 0, curr_items_tot : 0, ep_bg_fetched : 0, get_hits : 0, mem_used : 34329928, ops : 0, vb_replica_curr_items : 0 }, uptime : '3223', memoryTotal : 6191300608, memoryFree : 2922954752, mcdMemoryReserved : 4723, mcdMemoryAllocated : 4723, couchApiBase : 'http://0.0.0.0:9501/', clusterMembership : 'active', recoveryType : 'none', status : 'healthy', otpNode : 'n_1@0.0.0.0', hostname : '0.0.0.0:9001', clusterCompatibility : 196608, version : '3.0.0r-902-g3d88063', os : 'x86_64-pc-linux-gnu', ports : { proxy : 12003, direct : 12002 }, group : 'Group 1', pendingEject : true }]);
  });

  it('should populate failover warnings model', function () {
    mnAdminServersService.populateFailoverWarningsModel(['failoverNeeded', 'rebalanceNeeded', 'hardNodesNeeded', 'softNodesNeeded', 'softRebalanceNeeded']);
    expect(mnAdminServersService.model.failoverWarnings).toEqual([
      undefined,
      'Rebalance required, some data is not currently replicated!',
      'At least two servers are required to provide replication!',
      'Additional active servers required to provide the desired number of replicas!',
      'Rebalance recommended, some data does not have the desired replicas configuration!'
    ]);
  });

  it('should populate rebalance model', function () {
    mnAdminServersService.populateRebalanceModel({"inRecoveryMode":false,"isLoadingSamples":false,"rebalanceStatus":"none","balanced":true,"pendingNodes":[]});
    expect(mnAdminServersService.model.rebalancing).toEqual(false);
    expect(mnAdminServersService.model.mayRebalanceWithoutSampleLoading).toEqual(false);
    expect(mnAdminServersService.model.mayRebalance).toEqual(false);

    mnAdminServersService.populateRebalanceModel({"inRecoveryMode":false,"isLoadingSamples":false,"rebalanceStatus":"none","balanced":false,"pendingNodes":[{}],});
    expect(mnAdminServersService.model.rebalancing).toEqual(false);
    expect(mnAdminServersService.model.mayRebalanceWithoutSampleLoading).toEqual(true);
    expect(mnAdminServersService.model.mayRebalance).toEqual(true);
  });

});