<div [formGroup]="group">
  <h4>Database Fragmentation</h4>
  <div class="desc">Set the database fragmentation level to determine the point when compaction is triggered.</div>

  <div
     class="formrow form-inline"
     formGroupName="databaseFragmentationThreshold">
    <input
       type="checkbox"
       <!-- ng-change="maybeDisableTimeInterval()" -->
       id="for-data-frag-percent"
       formControlName="percentageFlag">
    <label for="for-data-frag-percent"></label>
    <input
       type="number"
       <!-- ng-change="maybeDisableTimeInterval()" -->
       formControlName="percentage"
       >
    <small> %</small>
    <div
       class="error"
       [hidden]="!(bucketHttp.error | async)?.errors['databaseFragmentationThreshold[percentage]']">
      {{(bucketHttp.error | async)?.errors["databaseFragmentationThreshold[percentage]"]}}
    </div>
  </div>

  <div
     class="formrow form-inline"
     formGroupName="databaseFragmentationThreshold">
    <input
       type="checkbox"
       <!-- ng-change="maybeDisableTimeInterval()" -->
       id="for-data-frag-size"
       formControlName="sizeFlag">
    <label for="for-data-frag-size"></label>
    <input
       type="number"
       <!-- ng-change="maybeDisableTimeInterval()" -->
       formControlName="size">
    <small> MB</small>
    <div
       class="error"
       [hidden]="!(bucketHttp.error | async)?.errors['databaseFragmentationThreshold[size]']">
      {{(bucketHttp.error | async)?.errors["databaseFragmentationThreshold[size]"]}}
    </div>
  </div>

  <h4>View Fragmentation</h4>
  <div class="desc">Set the view fragmentation level to determine the point when compaction is triggered.</div>
  <div
     class="formrow form-inline"
     formGroupName="viewFragmentationThreshold">
    <input
       type="checkbox"
       <!-- ng-change="maybeDisableTimeInterval()" -->
       id="for-view-frag-percent"
       formControlName="percentageFlag">
    <label for="for-view-frag-percent"></label>
    <input
       <!-- ng-change="maybeDisableTimeInterval()" -->
       formControlName="percentage"
       type="number">
    <small> %</small>
    <div
       class="error"
       [hidden]="!(bucketHttp.error | async)?.errors['viewFragmentationThreshold[percentage]']">
      {{(bucketHttp.error | async)?.errors["viewFragmentationThreshold[percentage]"]}}
    </div>
  </div>

  <div
     class="formrow form-inline"
     formGroupName="viewFragmentationThreshold">
    <input
       <!-- ng-change="maybeDisableTimeInterval()" -->
       type="checkbox"
       id="for-view-frag-size"
       formControlName="sizeFlag">
    <label for="for-view-frag-size"></label>
    <input
       <!-- ng-change="maybeDisableTimeInterval()" -->
       type="number"
       formControlName="size">
    <small>MB</small>
    <div
       class="error"
       [hidden]="!(bucketHttp.error | async)?.errors['viewFragmentationThreshold[size]']">
      {{(bucketHttp.error | async)?.errors["viewFragmentationThreshold[size]"]}}
    </div>
  </div>

  <h4>Time Interval</h4>
  <div class="formrow">
    <input
       type="checkbox"
       formControlName="allowedTimePeriodFlag"
       id="for-enable-compaction-timeperiod">
    <label for="for-enable-compaction-timeperiod">Set the time interval for when compaction is allowed to run</label>

    <!-- <mn-period -->
    <!--    mn-period="allowedTimePeriod" -->
    <!--    auto-compaction-settings="autoCompactionSettings" -->
    <!--    rbac="rbac" -->
    <!--    errors="validationErrors"> -->
    <!-- </mn-period> -->

    <input
       type="checkbox"
       id="for-compact-parallel"
       formControlName="parallelDBAndViewCompaction"
       <!-- value="true" -->>


    <label for="for-compact-parallel">Compact buckets and views indexes in parallel</label>
    <div
       class="error"
       [hidden]="!(bucketHttp.error | async)?.errors['parallelDBAndViewCompaction']">
      {{(bucketHttp.error | async)?.errors["parallelDBAndViewCompaction"]}}
    </div>
  </div>

  <h4 [hidden]="!(
                !isBucketsSettings &&
                (compatVersion | async)?.atLeast40 &&
                (indexSettingsRead | async) &&
                (indexSettings | async)?.storageMode !== 'memory_optimized' &&
                (isEnterprise | async) === false)">Index Fragmentation</h4>
  <div [hidden]="!(
                 !isBucketsSettings &&
                 (compatVersion | async)?.atLeast40 &&
                 (indexSettingsRead | async)
                 (indexSettings | async)?.storageMode !== 'memory_optimized' &&
                 (isEnterprise | async) === false)">
    <div class="formrow form-inline checkbox-list">
      <input
         type="radio"
         formControlName="indexCircularCompactionFlag"
         id="index-regular-compaction-radio"
         value="false">
      <label for="index-regular-compaction-radio">Append-only write mode with index fragmentation level trigger:</label>
      <br>
      <div formGroupName="indexFragmentationThreshold">
        <input
           type="number"
           formControlName="percentage">
        %
      </div>
      <small
         class="error"
         [hidden]="!(bucketHttp.error | async)?.errors['indexFragmentationThreshold[percentage]']">
        {{(bucketHttp.error | async)?.errors["indexFragmentationThreshold[percentage]"]}}
      </small>
    </div>
    <div class="formrow">
      <input
         type="radio"
         formControlName="indexCircularCompactionFlag"
         id="for-index-circular-compaction"
         value="true">
      <label for="for-index-circular-compaction">Circular write mode with day + time interval trigger:</label>
      <br>
      <span *ngFor="let day of daysOfWeek"
            formGroupName="indexCircularCompactionDaysOfWeek">
        <input
           type="checkbox"
           id="for-compaction-day-{{day}}"
           formControlName="{{day}}">
        <label for="for-compaction-day-{{day}}">{{day}}</label>
      </span>
    </div>

    <!-- <mn-period -->
    <!--    mn-period="indexCircularCompaction" -->
    <!--    auto-compaction-settings="autoCompactionSettings" -->
    <!--    rbac="rbac" -->
    <!--    errors="validationErrors"> -->
    <!-- </mn-period> -->
  </div>

  <div class="formrow">
    <label class="inline">Tombstone Purge Interval</label>
    <ng-template #tombstonePurgeIntervalTooltip>
      Sets the time period during which tombstones (metadata on deleted items) may remain on disk. The default value is 3 days. The acceptable range of values is 0.04 â€“ 60, where 0.04 = 1 hour and 1 = 1 day. Setting this value too high may significantly delay reclaiming of disk space; setting it too low may cause data inconsistencies in XDCR.
    </ng-template>
    <span
       class="fa-stack icon-info"
       [ngbTooltip]="tombstonePurgeIntervalTooltip"
       placement="top">
      <span class="icon fa-circle-thin fa-stack-2x"></span>
      <span class="icon fa-info fa-stack-1x"></span>
    </span>
    <div>
      <div class="form-inline formrow">
        <input
           type="text"
           formControlName="purgeInterval"
           id="metadata-purge-frequency"
           class="input-short-1">
        <small>day
          <span [hidden]="group.get('purgeInterval').value == 1">s</span>
        </small>
        <br>
        <div class="desc">Range .04 (1hr) - 60 days</div>
      </div>
      <div
         class="error"
         [hidden]="!(bucketHttp.error | async)?.errors.purgeInterval">
        {{(bucketHttp.error | async)?.errors.purgeInterval}}
      </div>
    </div>
  </div>

  <div
     [hidden]="!(
               ((indexSettingsRead | async) &&
               (indexSettings | async)?.storageMode == 'memory_optimized') ||
               (isEnterprise | async))"
     class="content-box margin-top1">
    <strong>NOTE</strong>&nbsp; Auto-compaction settings are unnecessary for memory-optimized and plasma-based indexes.
  </div>

</div>
