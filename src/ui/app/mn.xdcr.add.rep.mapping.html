<div [formGroup]="group"
   class="row flex-left margin-bottom-1">
  <label class="toggle-control margin-0">
    <input
       formControlName="collectionsExplicitMapping"
       id="collections_explicit_mapping"
       type="checkbox">
    <span class="toggle-control-body"></span>
  </label>
  <span class="text-small margin-left-half">
    Specify Scopes, Collections, and Mappings
  </span>
</div>

<div [hidden]="!group.get('collectionsExplicitMapping').value">
  <div
     class="error error-field"
     [hidden]="!(postCreateReplication.error | async)?.colMappingRules">
    {{(postCreateReplication.error | async)?.colMappingRules}}
  </div>
  <div
     class="error error-field"
     [hidden]="!(postSettingsReplications.error | async)?.colMappingRules">
    {{(postSettingsReplications.error | async)?.colMappingRules}}
  </div>

  <div class="row">
    <span class="column">
      <h4>Scopes & Collections to Replicate</h4>
      <p class="desc">
        <span class="icon fa-warning warning margin-right-half"></span>
        Leave scopes & collections unchecked if you simply want to replicate everything.
        Checking anything here explicitly excludes anything left unchecked.<br>
        <span class="icon fa-warning warning margin-right-half"></span>
        Scopes and collections to be removed by filtering rules set above will STILL BE SHOWN in this list.
      </p>
    </span>
  </div>

  <mn-xdcr-add-rep-mapping-controls
     class="padding-0"
     *ngFor="let root of (scopes | async);"
     [item]="root"
     parent="root"
     keyspace="scopes"
     [explicitMappingGroup]="explicitMappingGroup"
     [explicitMappingRules]="explicitMappingRules">
  </mn-xdcr-add-rep-mapping-controls>
</div>

<!-- Migration Mode controls ----------------------------------------------- -->
<div
   [formGroup]="group"
   class="row flex-left margin-bottom-1 margin-top-2">
  <label class="toggle-control margin-0">
    <input
       formControlName="collectionsMigrationMode"
       id="collections_migration_mode"
       type="checkbox">
    <span class="toggle-control-body"></span>
  </label>
  <span class="text-small margin-left-half margin-right-quarter">Use Migration Mode</span>

  <span
     class="fa-stack icon-info"
     ngbTooltip="Use Collections Migration Mode to move data from the default
                 collection on source to one or more named collections on the
                 target. Optionally you can specify a filter on the source default
                 collection. You can create multiple such mappings to split the
                 default collection into multiple named collections on the target
                 Unlike typical replications, this one should be deleted once
                 migration is successful."
     placement="auto right"
     container="body">
    <span class="icon fa-circle-thin fa-stack-2x"></span>
    <span class="icon fa-info fa-stack-1x"></span>
  </span>
</div>

<div
   [formGroup]="explicitMappingGroup.migrationMode"
   [hidden]="!group.get('collectionsMigrationMode').value"
   class="margin-bottom-1-5">
  <div class="formrow row flex-left items-stretch resp-flex-column-s">
    <div class="column width-4">
      <label for="migration_to_collection">Target Collection</label>
      <input
         class="width-12"
         id="migration_to_collection"
         formControlName="target"
         placeholder="...specify target as scope.collection"
         type="text"
         autocorrect="off"
         spellcheck="false"
         autocapitalize="off">
    </div>
    <div class="width-4">
      <label for="migration_from_collection">
        Optional Filter Expression
      </label>
      <input
         class="width-12"
         id="migration_from_collection"
         formControlName="key"
         placeholder="e.g. REGEXP_CONTAINS(type, 'airport')"
         type="text"
         autocorrect="off"
         spellcheck="false"
         autocapitalize="off">
    </div>
    <button
       class=" outline tight margin-top-1-5 margin-left-quarter inline"
       type="button"
       (click)="addExplicitMappingMigrationRules.next()">Save Mapping</button>
  </div>
  <div
     class="error error-field pre-line"
     [hidden]="!(postCreateReplication.error | async)?.colMappingRules">
    {{(postCreateReplication.error | async)?.colMappingRules}}
  </div>
  <div
     class="error error-field pre-line"
     [hidden]="!(postSettingsReplications.error | async)?.colMappingRules">
    {{(postSettingsReplications.error | async)?.colMappingRules}}
  </div>
</div>
