import{d as t,i as e}from"./common/index-35caf4f7.js";import{e as n,c as r}from"./common/index-e88ffd88.js";import{s,t as i,m as a}from"./common/touch-775b0bb4.js";import{d as o,y as u}from"./common/nodrag-20481c62.js";import"./common/rgb-50db7803.js";import{i as l}from"./common/value-2cd045dd.js";import"./common/string-cfd0b55d.js";import"./common/index-f3df269c.js";function c(t){return function(){return t}}function h(t,e,n){this.target=t,this.type=e,this.selection=n}function f(){n.stopImmediatePropagation()}function m(){n.preventDefault(),n.stopImmediatePropagation()}var p={name:"drag"},d={name:"space"},y={name:"handle"},b={name:"center"};function v(t){return[+t[0],+t[1]]}function w(t){return[v(t[0]),v(t[1])]}function g(t){return function(e){return i(e,n.touches,t)}}var x={name:"x",handles:["w","e"].map(T),input:function(t,e){return null==t?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},M={name:"y",handles:["n","s"].map(T),input:function(t,e){return null==t?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},_={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(T),input:function(t){return null==t?null:w(t)},output:function(t){return t}},k={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},z={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},j={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},A={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},K={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function T(t){return{type:t}}function V(){return!n.ctrlKey&&!n.button}function P(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function B(){return navigator.maxTouchPoints||"ontouchstart"in this}function C(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function E(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function I(t){var e=t.__brush;return e?e.dim.output(e.selection):null}function S(){return N(x)}function D(){return N(M)}function G(){return N(_)}function N(i){var v,_=P,I=V,S=B,D=!0,G=t("start","brush","end"),N=6;function q(t){var e=t.property("__brush",R).selectAll(".overlay").data([T("overlay")]);e.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",k.overlay).merge(e).each((function(){var t=C(this).extent;s(this).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1])})),t.selectAll(".selection").data([T("selection")]).enter().append("rect").attr("class","selection").attr("cursor",k.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var n=t.selectAll(".handle").data(i.handles,(function(t){return t.type}));n.exit().remove(),n.enter().append("rect").attr("class",(function(t){return"handle handle--"+t.type})).attr("cursor",(function(t){return k[t.type]})),t.each(F).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",L).filter(S).on("touchstart.brush",L).on("touchmove.brush",O).on("touchend.brush touchcancel.brush",Q).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function F(){var t=s(this),e=C(this).selection;e?(t.selectAll(".selection").style("display",null).attr("x",e[0][0]).attr("y",e[0][1]).attr("width",e[1][0]-e[0][0]).attr("height",e[1][1]-e[0][1]),t.selectAll(".handle").style("display",null).attr("x",(function(t){return"e"===t.type[t.type.length-1]?e[1][0]-N/2:e[0][0]-N/2})).attr("y",(function(t){return"s"===t.type[0]?e[1][1]-N/2:e[0][1]-N/2})).attr("width",(function(t){return"n"===t.type||"s"===t.type?e[1][0]-e[0][0]+N:N})).attr("height",(function(t){return"e"===t.type||"w"===t.type?e[1][1]-e[0][1]+N:N}))):t.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function H(t,e,n){return!n&&t.__brush.emitter||new J(t,e)}function J(t,e){this.that=t,this.args=e,this.state=t.__brush,this.active=0}function L(){if((!v||n.touches)&&I.apply(this,arguments)){var t,r,l,c,h,w,_,T,V,P,B,S=this,G=n.target.__data__.type,N="selection"===(D&&n.metaKey?G="overlay":G)?p:D&&n.altKey?b:y,q=i===M?null:A[G],J=i===x?null:K[G],L=C(S),O=L.extent,Q=L.selection,R=O[0][0],U=O[0][1],W=O[1][0],X=O[1][1],Y=0,Z=0,$=q&&J&&D&&n.shiftKey,tt=n.touches?g(n.changedTouches[0].identifier):a,et=tt(S),nt=et,rt=H(S,arguments,!0).beforestart();"overlay"===G?(Q&&(V=!0),L.selection=Q=[[t=i===M?R:et[0],l=i===x?U:et[1]],[h=i===M?W:t,_=i===x?X:l]]):(t=Q[0][0],l=Q[0][1],h=Q[1][0],_=Q[1][1]),r=t,c=l,w=h,T=_;var st=s(S).attr("pointer-events","none"),it=st.selectAll(".overlay").attr("cursor",k[G]);if(n.touches)rt.moved=ot,rt.ended=lt;else{var at=s(n.view).on("mousemove.brush",ot,!0).on("mouseup.brush",lt,!0);D&&at.on("keydown.brush",ct,!0).on("keyup.brush",ht,!0),o(n.view)}f(),e(S),F.call(S),rt.start()}function ot(){var t=tt(S);!$||P||B||(Math.abs(t[0]-nt[0])>Math.abs(t[1]-nt[1])?B=!0:P=!0),nt=t,V=!0,m(),ut()}function ut(){var e;switch(Y=nt[0]-et[0],Z=nt[1]-et[1],N){case d:case p:q&&(Y=Math.max(R-t,Math.min(W-h,Y)),r=t+Y,w=h+Y),J&&(Z=Math.max(U-l,Math.min(X-_,Z)),c=l+Z,T=_+Z);break;case y:q<0?(Y=Math.max(R-t,Math.min(W-t,Y)),r=t+Y,w=h):q>0&&(Y=Math.max(R-h,Math.min(W-h,Y)),r=t,w=h+Y),J<0?(Z=Math.max(U-l,Math.min(X-l,Z)),c=l+Z,T=_):J>0&&(Z=Math.max(U-_,Math.min(X-_,Z)),c=l,T=_+Z);break;case b:q&&(r=Math.max(R,Math.min(W,t-Y*q)),w=Math.max(R,Math.min(W,h+Y*q))),J&&(c=Math.max(U,Math.min(X,l-Z*J)),T=Math.max(U,Math.min(X,_+Z*J)))}w<r&&(q*=-1,e=t,t=h,h=e,e=r,r=w,w=e,G in z&&it.attr("cursor",k[G=z[G]])),T<c&&(J*=-1,e=l,l=_,_=e,e=c,c=T,T=e,G in j&&it.attr("cursor",k[G=j[G]])),L.selection&&(Q=L.selection),P&&(r=Q[0][0],w=Q[1][0]),B&&(c=Q[0][1],T=Q[1][1]),Q[0][0]===r&&Q[0][1]===c&&Q[1][0]===w&&Q[1][1]===T||(L.selection=[[r,c],[w,T]],F.call(S),rt.brush())}function lt(){if(f(),n.touches){if(n.touches.length)return;v&&clearTimeout(v),v=setTimeout((function(){v=null}),500)}else u(n.view,V),at.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);st.attr("pointer-events","all"),it.attr("cursor",k.overlay),L.selection&&(Q=L.selection),E(Q)&&(L.selection=null,F.call(S)),rt.end()}function ct(){switch(n.keyCode){case 16:$=q&&J;break;case 18:N===y&&(q&&(h=w-Y*q,t=r+Y*q),J&&(_=T-Z*J,l=c+Z*J),N=b,ut());break;case 32:N!==y&&N!==b||(q<0?h=w-Y:q>0&&(t=r-Y),J<0?_=T-Z:J>0&&(l=c-Z),N=d,it.attr("cursor",k.selection),ut());break;default:return}m()}function ht(){switch(n.keyCode){case 16:$&&(P=B=$=!1,ut());break;case 18:N===b&&(q<0?h=w:q>0&&(t=r),J<0?_=T:J>0&&(l=c),N=y,ut());break;case 32:N===d&&(n.altKey?(q&&(h=w-Y*q,t=r+Y*q),J&&(_=T-Z*J,l=c+Z*J),N=b):(q<0?h=w:q>0&&(t=r),J<0?_=T:J>0&&(l=c),N=y),it.attr("cursor",k[G]),ut());break;default:return}m()}}function O(){H(this,arguments).moved()}function Q(){H(this,arguments).ended()}function R(){var t=this.__brush||{selection:null};return t.extent=w(_.apply(this,arguments)),t.dim=i,t}return q.move=function(t,n){t.selection?t.on("start.brush",(function(){H(this,arguments).beforestart().start()})).on("interrupt.brush end.brush",(function(){H(this,arguments).end()})).tween("brush",(function(){var t=this,e=t.__brush,r=H(t,arguments),s=e.selection,a=i.input("function"==typeof n?n.apply(this,arguments):n,e.extent),o=l(s,a);function u(n){e.selection=1===n&&null===a?null:o(n),F.call(t),r.brush()}return null!==s&&null!==a?u:u(1)})):t.each((function(){var t=this,r=arguments,s=t.__brush,a=i.input("function"==typeof n?n.apply(t,r):n,s.extent),o=H(t,r).beforestart();e(t),s.selection=null===a?null:a,F.call(t),o.start().brush().end()}))},q.clear=function(t){q.move(t,null)},J.prototype={beforestart:function(){return 1==++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting?(this.starting=!1,this.emit("start")):this.emit("brush"),this},brush:function(){return this.emit("brush"),this},end:function(){return 0==--this.active&&(delete this.state.emitter,this.emit("end")),this},emit:function(t){r(new h(q,t,i.output(this.state.selection)),G.apply,G,[t,this.that,this.args])}},q.extent=function(t){return arguments.length?(_="function"==typeof t?t:c(w(t)),q):_},q.filter=function(t){return arguments.length?(I="function"==typeof t?t:c(!!t),q):I},q.touchable=function(t){return arguments.length?(S="function"==typeof t?t:c(!!t),q):S},q.handleSize=function(t){return arguments.length?(N=+t,q):N},q.keyModifiers=function(t){return arguments.length?(D=!!t,q):D},q.on=function(){var t=G.on.apply(G,arguments);return t===G?q:t},q}export{G as brush,I as brushSelection,S as brushX,D as brushY};
//# sourceMappingURL=d3-brush.js.map
