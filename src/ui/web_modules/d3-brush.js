import{event as t,select as e,customEvent as n,touch as r,mouse as s}from"./d3-selection.js";import{i}from"./common/index-1654fcb4.js";import{d as a,i as u}from"./common/index-4f075102.js";import{d as o,y as l}from"./common/index-8b74b463.js";function c(t){return function(){return t}}function h(t,e,n){this.target=t,this.type=e,this.selection=n}function f(){t.stopImmediatePropagation()}function p(){t.preventDefault(),t.stopImmediatePropagation()}var m={name:"drag"},y={name:"space"},d={name:"handle"},b={name:"center"};function v(t){return[+t[0],+t[1]]}function w(t){return[v(t[0]),v(t[1])]}function x(e){return function(n){return r(n,t.touches,e)}}var g={name:"x",handles:["w","e"].map(T),input:function(t,e){return null==t?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},M={name:"y",handles:["n","s"].map(T),input:function(t,e){return null==t?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},_={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(T),input:function(t){return null==t?null:w(t)},output:function(t){return t}},k={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},z={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},A={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},K={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},j={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function T(t){return{type:t}}function V(){return!t.ctrlKey&&!t.button}function P(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function B(){return navigator.maxTouchPoints||"ontouchstart"in this}function C(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function E(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function I(t){var e=t.__brush;return e?e.dim.output(e.selection):null}function S(){return N(g)}function D(){return N(M)}function G(){return N(_)}function N(r){var v,_=P,I=V,S=B,D=!0,G=a("start","brush","end"),N=6;function q(t){var n=t.property("__brush",R).selectAll(".overlay").data([T("overlay")]);n.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",k.overlay).merge(n).each((function(){var t=C(this).extent;e(this).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1])})),t.selectAll(".selection").data([T("selection")]).enter().append("rect").attr("class","selection").attr("cursor",k.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var s=t.selectAll(".handle").data(r.handles,(function(t){return t.type}));s.exit().remove(),s.enter().append("rect").attr("class",(function(t){return"handle handle--"+t.type})).attr("cursor",(function(t){return k[t.type]})),t.each(F).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",L).filter(S).on("touchstart.brush",L).on("touchmove.brush",O).on("touchend.brush touchcancel.brush",Q).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function F(){var t=e(this),n=C(this).selection;n?(t.selectAll(".selection").style("display",null).attr("x",n[0][0]).attr("y",n[0][1]).attr("width",n[1][0]-n[0][0]).attr("height",n[1][1]-n[0][1]),t.selectAll(".handle").style("display",null).attr("x",(function(t){return"e"===t.type[t.type.length-1]?n[1][0]-N/2:n[0][0]-N/2})).attr("y",(function(t){return"s"===t.type[0]?n[1][1]-N/2:n[0][1]-N/2})).attr("width",(function(t){return"n"===t.type||"s"===t.type?n[1][0]-n[0][0]+N:N})).attr("height",(function(t){return"e"===t.type||"w"===t.type?n[1][1]-n[0][1]+N:N}))):t.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function H(t,e,n){return!n&&t.__brush.emitter||new J(t,e)}function J(t,e){this.that=t,this.args=e,this.state=t.__brush,this.active=0}function L(){if((!v||t.touches)&&I.apply(this,arguments)){var n,i,a,c,h,w,_,T,V,P,B,S=this,G=t.target.__data__.type,N="selection"===(D&&t.metaKey?G="overlay":G)?m:D&&t.altKey?b:d,q=r===M?null:K[G],J=r===g?null:j[G],L=C(S),O=L.extent,Q=L.selection,R=O[0][0],U=O[0][1],W=O[1][0],X=O[1][1],Y=0,Z=0,$=q&&J&&D&&t.shiftKey,tt=t.touches?x(t.changedTouches[0].identifier):s,et=tt(S),nt=et,rt=H(S,arguments,!0).beforestart();"overlay"===G?(Q&&(V=!0),L.selection=Q=[[n=r===M?R:et[0],a=r===g?U:et[1]],[h=r===M?W:n,_=r===g?X:a]]):(n=Q[0][0],a=Q[0][1],h=Q[1][0],_=Q[1][1]),i=n,c=a,w=h,T=_;var st=e(S).attr("pointer-events","none"),it=st.selectAll(".overlay").attr("cursor",k[G]);if(t.touches)rt.moved=ut,rt.ended=lt;else{var at=e(t.view).on("mousemove.brush",ut,!0).on("mouseup.brush",lt,!0);D&&at.on("keydown.brush",ct,!0).on("keyup.brush",ht,!0),o(t.view)}f(),u(S),F.call(S),rt.start()}function ut(){var t=tt(S);!$||P||B||(Math.abs(t[0]-nt[0])>Math.abs(t[1]-nt[1])?B=!0:P=!0),nt=t,V=!0,p(),ot()}function ot(){var t;switch(Y=nt[0]-et[0],Z=nt[1]-et[1],N){case y:case m:q&&(Y=Math.max(R-n,Math.min(W-h,Y)),i=n+Y,w=h+Y),J&&(Z=Math.max(U-a,Math.min(X-_,Z)),c=a+Z,T=_+Z);break;case d:q<0?(Y=Math.max(R-n,Math.min(W-n,Y)),i=n+Y,w=h):q>0&&(Y=Math.max(R-h,Math.min(W-h,Y)),i=n,w=h+Y),J<0?(Z=Math.max(U-a,Math.min(X-a,Z)),c=a+Z,T=_):J>0&&(Z=Math.max(U-_,Math.min(X-_,Z)),c=a,T=_+Z);break;case b:q&&(i=Math.max(R,Math.min(W,n-Y*q)),w=Math.max(R,Math.min(W,h+Y*q))),J&&(c=Math.max(U,Math.min(X,a-Z*J)),T=Math.max(U,Math.min(X,_+Z*J)))}w<i&&(q*=-1,t=n,n=h,h=t,t=i,i=w,w=t,G in z&&it.attr("cursor",k[G=z[G]])),T<c&&(J*=-1,t=a,a=_,_=t,t=c,c=T,T=t,G in A&&it.attr("cursor",k[G=A[G]])),L.selection&&(Q=L.selection),P&&(i=Q[0][0],w=Q[1][0]),B&&(c=Q[0][1],T=Q[1][1]),Q[0][0]===i&&Q[0][1]===c&&Q[1][0]===w&&Q[1][1]===T||(L.selection=[[i,c],[w,T]],F.call(S),rt.brush())}function lt(){if(f(),t.touches){if(t.touches.length)return;v&&clearTimeout(v),v=setTimeout((function(){v=null}),500)}else l(t.view,V),at.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);st.attr("pointer-events","all"),it.attr("cursor",k.overlay),L.selection&&(Q=L.selection),E(Q)&&(L.selection=null,F.call(S)),rt.end()}function ct(){switch(t.keyCode){case 16:$=q&&J;break;case 18:N===d&&(q&&(h=w-Y*q,n=i+Y*q),J&&(_=T-Z*J,a=c+Z*J),N=b,ot());break;case 32:N!==d&&N!==b||(q<0?h=w-Y:q>0&&(n=i-Y),J<0?_=T-Z:J>0&&(a=c-Z),N=y,it.attr("cursor",k.selection),ot());break;default:return}p()}function ht(){switch(t.keyCode){case 16:$&&(P=B=$=!1,ot());break;case 18:N===b&&(q<0?h=w:q>0&&(n=i),J<0?_=T:J>0&&(a=c),N=d,ot());break;case 32:N===y&&(t.altKey?(q&&(h=w-Y*q,n=i+Y*q),J&&(_=T-Z*J,a=c+Z*J),N=b):(q<0?h=w:q>0&&(n=i),J<0?_=T:J>0&&(a=c),N=d),it.attr("cursor",k[G]),ot());break;default:return}p()}}function O(){H(this,arguments).moved()}function Q(){H(this,arguments).ended()}function R(){var t=this.__brush||{selection:null};return t.extent=w(_.apply(this,arguments)),t.dim=r,t}return q.move=function(t,e){t.selection?t.on("start.brush",(function(){H(this,arguments).beforestart().start()})).on("interrupt.brush end.brush",(function(){H(this,arguments).end()})).tween("brush",(function(){var t=this,n=t.__brush,s=H(t,arguments),a=n.selection,u=r.input("function"==typeof e?e.apply(this,arguments):e,n.extent),o=i(a,u);function l(e){n.selection=1===e&&null===u?null:o(e),F.call(t),s.brush()}return null!==a&&null!==u?l:l(1)})):t.each((function(){var t=this,n=arguments,s=t.__brush,i=r.input("function"==typeof e?e.apply(t,n):e,s.extent),a=H(t,n).beforestart();u(t),s.selection=null===i?null:i,F.call(t),a.start().brush().end()}))},q.clear=function(t){q.move(t,null)},J.prototype={beforestart:function(){return 1==++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting?(this.starting=!1,this.emit("start")):this.emit("brush"),this},brush:function(){return this.emit("brush"),this},end:function(){return 0==--this.active&&(delete this.state.emitter,this.emit("end")),this},emit:function(t){n(new h(q,t,r.output(this.state.selection)),G.apply,G,[t,this.that,this.args])}},q.extent=function(t){return arguments.length?(_="function"==typeof t?t:c(w(t)),q):_},q.filter=function(t){return arguments.length?(I="function"==typeof t?t:c(!!t),q):I},q.touchable=function(t){return arguments.length?(S="function"==typeof t?t:c(!!t),q):S},q.handleSize=function(t){return arguments.length?(N=+t,q):N},q.keyModifiers=function(t){return arguments.length?(D=!!t,q):D},q.on=function(){var t=G.on.apply(G,arguments);return t===G?q:t},q}export{G as brush,I as brushSelection,S as brushX,D as brushY};
//# sourceMappingURL=d3-brush.js.map
