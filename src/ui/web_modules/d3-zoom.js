import{d as t,i as n}from"./common/index-35caf4f7.js";import{e as o,c as i}from"./common/index-e88ffd88.js";import{m as e,s as r,t as s}from"./common/touch-775b0bb4.js";import{d as u,y as h}from"./common/nodrag-20481c62.js";import"./common/rgb-50db7803.js";import"./common/string-cfd0b55d.js";import"./common/index-f3df269c.js";import{i as c}from"./common/zoom-74300348.js";function a(t){return function(){return t}}function f(t,n,o){this.target=t,this.type=n,this.transform=o}function m(t,n,o){this.k=t,this.x=n,this.y=o}m.prototype={constructor:m,scale:function(t){return 1===t?this:new m(this.k*t,this.x,this.y)},translate:function(t,n){return 0===t&0===n?this:new m(this.k,this.x+this.k*t,this.y+this.k*n)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var l=new m(1,0,0);function p(t){for(;!t.__zoom;)if(!(t=t.parentNode))return l;return t.__zoom}function y(){o.stopImmediatePropagation()}function v(){o.preventDefault(),o.stopImmediatePropagation()}function d(){return!o.ctrlKey&&!o.button}function z(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function _(){return this.__zoom||l}function g(){return-o.deltaY*(1===o.deltaMode?.05:o.deltaMode?1:.002)}function x(){return navigator.maxTouchPoints||"ontouchstart"in this}function k(t,n,o){var i=t.invertX(n[0][0])-o[0][0],e=t.invertX(n[1][0])-o[1][0],r=t.invertY(n[0][1])-o[0][1],s=t.invertY(n[1][1])-o[1][1];return t.translate(e>i?(i+e)/2:Math.min(0,i)||Math.max(0,e),s>r?(r+s)/2:Math.min(0,r)||Math.max(0,s))}function w(){var p,w,b=d,T=z,M=k,Y=g,j=x,X=[0,1/0],V=[[-1/0,-1/0],[1/0,1/0]],B=250,E=c,D=t("start","zoom","end"),I=0;function P(t){t.property("__zoom",_).on("wheel.zoom",N).on("mousedown.zoom",W).on("dblclick.zoom",C).filter(j).on("touchstart.zoom",F).on("touchmove.zoom",J).on("touchend.zoom touchcancel.zoom",L).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function S(t,n){return(n=Math.max(X[0],Math.min(X[1],n)))===t.k?t:new m(n,t.x,t.y)}function q(t,n,o){var i=n[0]-o[0]*t.k,e=n[1]-o[1]*t.k;return i===t.x&&e===t.y?t:new m(t.k,i,e)}function G(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function K(t,n,o){t.on("start.zoom",(function(){A(this,arguments).start()})).on("interrupt.zoom end.zoom",(function(){A(this,arguments).end()})).tween("zoom",(function(){var t=this,i=arguments,e=A(t,i),r=T.apply(t,i),s=null==o?G(r):"function"==typeof o?o.apply(t,i):o,u=Math.max(r[1][0]-r[0][0],r[1][1]-r[0][1]),h=t.__zoom,c="function"==typeof n?n.apply(t,i):n,a=E(h.invert(s).concat(u/h.k),c.invert(s).concat(u/c.k));return function(t){if(1===t)t=c;else{var n=a(t),o=u/n[2];t=new m(o,s[0]-n[0]*o,s[1]-n[1]*o)}e.zoom(null,t)}}))}function A(t,n,o){return!o&&t.__zooming||new H(t,n)}function H(t,n){this.that=t,this.args=n,this.active=0,this.extent=T.apply(t,n),this.taps=0}function N(){if(b.apply(this,arguments)){var t=A(this,arguments),o=this.__zoom,i=Math.max(X[0],Math.min(X[1],o.k*Math.pow(2,Y.apply(this,arguments)))),r=e(this);if(t.wheel)t.mouse[0][0]===r[0]&&t.mouse[0][1]===r[1]||(t.mouse[1]=o.invert(t.mouse[0]=r)),clearTimeout(t.wheel);else{if(o.k===i)return;t.mouse=[r,o.invert(r)],n(this),t.start()}v(),t.wheel=setTimeout(s,150),t.zoom("mouse",M(q(S(o,i),t.mouse[0],t.mouse[1]),t.extent,V))}function s(){t.wheel=null,t.end()}}function W(){if(!w&&b.apply(this,arguments)){var t=A(this,arguments,!0),i=r(o.view).on("mousemove.zoom",f,!0).on("mouseup.zoom",m,!0),s=e(this),c=o.clientX,a=o.clientY;u(o.view),y(),t.mouse=[s,this.__zoom.invert(s)],n(this),t.start()}function f(){if(v(),!t.moved){var n=o.clientX-c,i=o.clientY-a;t.moved=n*n+i*i>I}t.zoom("mouse",M(q(t.that.__zoom,t.mouse[0]=e(t.that),t.mouse[1]),t.extent,V))}function m(){i.on("mousemove.zoom mouseup.zoom",null),h(o.view,t.moved),v(),t.end()}}function C(){if(b.apply(this,arguments)){var t=this.__zoom,n=e(this),i=t.invert(n),s=t.k*(o.shiftKey?.5:2),u=M(q(S(t,s),n,i),T.apply(this,arguments),V);v(),B>0?r(this).transition().duration(B).call(K,u,n):r(this).call(P.transform,u)}}function F(){if(b.apply(this,arguments)){var t,i,e,r,u=o.touches,h=u.length,c=A(this,arguments,o.changedTouches.length===h);for(y(),i=0;i<h;++i)e=u[i],r=[r=s(this,u,e.identifier),this.__zoom.invert(r),e.identifier],c.touch0?c.touch1||c.touch0[2]===r[2]||(c.touch1=r,c.taps=0):(c.touch0=r,t=!0,c.taps=1+!!p);p&&(p=clearTimeout(p)),t&&(c.taps<2&&(p=setTimeout((function(){p=null}),500)),n(this),c.start())}}function J(){if(this.__zooming){var t,n,i,e,r=A(this,arguments),u=o.changedTouches,h=u.length;for(v(),p&&(p=clearTimeout(p)),r.taps=0,t=0;t<h;++t)n=u[t],i=s(this,u,n.identifier),r.touch0&&r.touch0[2]===n.identifier?r.touch0[0]=i:r.touch1&&r.touch1[2]===n.identifier&&(r.touch1[0]=i);if(n=r.that.__zoom,r.touch1){var c=r.touch0[0],a=r.touch0[1],f=r.touch1[0],m=r.touch1[1],l=(l=f[0]-c[0])*l+(l=f[1]-c[1])*l,y=(y=m[0]-a[0])*y+(y=m[1]-a[1])*y;n=S(n,Math.sqrt(l/y)),i=[(c[0]+f[0])/2,(c[1]+f[1])/2],e=[(a[0]+m[0])/2,(a[1]+m[1])/2]}else{if(!r.touch0)return;i=r.touch0[0],e=r.touch0[1]}r.zoom("touch",M(q(n,i,e),r.extent,V))}}function L(){if(this.__zooming){var t,n,i=A(this,arguments),e=o.changedTouches,s=e.length;for(y(),w&&clearTimeout(w),w=setTimeout((function(){w=null}),500),t=0;t<s;++t)n=e[t],i.touch0&&i.touch0[2]===n.identifier?delete i.touch0:i.touch1&&i.touch1[2]===n.identifier&&delete i.touch1;if(i.touch1&&!i.touch0&&(i.touch0=i.touch1,delete i.touch1),i.touch0)i.touch0[1]=this.__zoom.invert(i.touch0[0]);else if(i.end(),2===i.taps){var u=r(this).on("dblclick.zoom");u&&u.apply(this,arguments)}}}return P.transform=function(t,n,o){var i=t.selection?t.selection():t;i.property("__zoom",_),t!==i?K(t,n,o):i.interrupt().each((function(){A(this,arguments).start().zoom(null,"function"==typeof n?n.apply(this,arguments):n).end()}))},P.scaleBy=function(t,n,o){P.scaleTo(t,(function(){var t=this.__zoom.k,o="function"==typeof n?n.apply(this,arguments):n;return t*o}),o)},P.scaleTo=function(t,n,o){P.transform(t,(function(){var t=T.apply(this,arguments),i=this.__zoom,e=null==o?G(t):"function"==typeof o?o.apply(this,arguments):o,r=i.invert(e),s="function"==typeof n?n.apply(this,arguments):n;return M(q(S(i,s),e,r),t,V)}),o)},P.translateBy=function(t,n,o){P.transform(t,(function(){return M(this.__zoom.translate("function"==typeof n?n.apply(this,arguments):n,"function"==typeof o?o.apply(this,arguments):o),T.apply(this,arguments),V)}))},P.translateTo=function(t,n,o,i){P.transform(t,(function(){var t=T.apply(this,arguments),e=this.__zoom,r=null==i?G(t):"function"==typeof i?i.apply(this,arguments):i;return M(l.translate(r[0],r[1]).scale(e.k).translate("function"==typeof n?-n.apply(this,arguments):-n,"function"==typeof o?-o.apply(this,arguments):-o),t,V)}),i)},H.prototype={start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,n){return this.mouse&&"mouse"!==t&&(this.mouse[1]=n.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=n.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=n.invert(this.touch1[0])),this.that.__zoom=n,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){i(new f(P,t,this.that.__zoom),D.apply,D,[t,this.that,this.args])}},P.wheelDelta=function(t){return arguments.length?(Y="function"==typeof t?t:a(+t),P):Y},P.filter=function(t){return arguments.length?(b="function"==typeof t?t:a(!!t),P):b},P.touchable=function(t){return arguments.length?(j="function"==typeof t?t:a(!!t),P):j},P.extent=function(t){return arguments.length?(T="function"==typeof t?t:a([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),P):T},P.scaleExtent=function(t){return arguments.length?(X[0]=+t[0],X[1]=+t[1],P):[X[0],X[1]]},P.translateExtent=function(t){return arguments.length?(V[0][0]=+t[0][0],V[1][0]=+t[1][0],V[0][1]=+t[0][1],V[1][1]=+t[1][1],P):[[V[0][0],V[0][1]],[V[1][0],V[1][1]]]},P.constrain=function(t){return arguments.length?(M=t,P):M},P.duration=function(t){return arguments.length?(B=+t,P):B},P.interpolate=function(t){return arguments.length?(E=t,P):E},P.on=function(){var t=D.on.apply(D,arguments);return t===D?P:t},P.clickDistance=function(t){return arguments.length?(I=(t=+t)*t,P):Math.sqrt(I)},P}p.prototype=m.prototype;export{w as zoom,l as zoomIdentity,p as zoomTransform};
//# sourceMappingURL=d3-zoom.js.map
