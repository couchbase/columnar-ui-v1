import{event as t,customEvent as n,mouse as o,select as i,touch as e}from"./d3-selection.js";import{s as r}from"./common/index-1654fcb4.js";import{d as u,i as h}from"./common/index-4f075102.js";import{d as s,y as c}from"./common/index-8b74b463.js";function a(t){return function(){return t}}function f(t,n,o){this.target=t,this.type=n,this.transform=o}function l(t,n,o){this.k=t,this.x=n,this.y=o}l.prototype={constructor:l,scale:function(t){return 1===t?this:new l(this.k*t,this.x,this.y)},translate:function(t,n){return 0===t&0===n?this:new l(this.k,this.x+this.k*t,this.y+this.k*n)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var m=new l(1,0,0);function p(t){for(;!t.__zoom;)if(!(t=t.parentNode))return m;return t.__zoom}function y(){t.stopImmediatePropagation()}function v(){t.preventDefault(),t.stopImmediatePropagation()}function d(){return!t.ctrlKey&&!t.button}function z(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function _(){return this.__zoom||m}function g(){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)}function x(){return navigator.maxTouchPoints||"ontouchstart"in this}function k(t,n,o){var i=t.invertX(n[0][0])-o[0][0],e=t.invertX(n[1][0])-o[1][0],r=t.invertY(n[0][1])-o[0][1],u=t.invertY(n[1][1])-o[1][1];return t.translate(e>i?(i+e)/2:Math.min(0,i)||Math.max(0,e),u>r?(r+u)/2:Math.min(0,r)||Math.max(0,u))}function w(){var p,w,T=d,M=z,b=k,Y=g,X=x,V=[0,1/0],j=[[-1/0,-1/0],[1/0,1/0]],B=250,E=r,D=u("start","zoom","end"),I=0;function P(t){t.property("__zoom",_).on("wheel.zoom",N).on("mousedown.zoom",W).on("dblclick.zoom",C).filter(X).on("touchstart.zoom",F).on("touchmove.zoom",J).on("touchend.zoom touchcancel.zoom",L).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function S(t,n){return(n=Math.max(V[0],Math.min(V[1],n)))===t.k?t:new l(n,t.x,t.y)}function q(t,n,o){var i=n[0]-o[0]*t.k,e=n[1]-o[1]*t.k;return i===t.x&&e===t.y?t:new l(t.k,i,e)}function G(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function K(t,n,o){t.on("start.zoom",(function(){A(this,arguments).start()})).on("interrupt.zoom end.zoom",(function(){A(this,arguments).end()})).tween("zoom",(function(){var t=this,i=arguments,e=A(t,i),r=M.apply(t,i),u=null==o?G(r):"function"==typeof o?o.apply(t,i):o,h=Math.max(r[1][0]-r[0][0],r[1][1]-r[0][1]),s=t.__zoom,c="function"==typeof n?n.apply(t,i):n,a=E(s.invert(u).concat(h/s.k),c.invert(u).concat(h/c.k));return function(t){if(1===t)t=c;else{var n=a(t),o=h/n[2];t=new l(o,u[0]-n[0]*o,u[1]-n[1]*o)}e.zoom(null,t)}}))}function A(t,n,o){return!o&&t.__zooming||new H(t,n)}function H(t,n){this.that=t,this.args=n,this.active=0,this.extent=M.apply(t,n),this.taps=0}function N(){if(T.apply(this,arguments)){var t=A(this,arguments),n=this.__zoom,i=Math.max(V[0],Math.min(V[1],n.k*Math.pow(2,Y.apply(this,arguments)))),e=o(this);if(t.wheel)t.mouse[0][0]===e[0]&&t.mouse[0][1]===e[1]||(t.mouse[1]=n.invert(t.mouse[0]=e)),clearTimeout(t.wheel);else{if(n.k===i)return;t.mouse=[e,n.invert(e)],h(this),t.start()}v(),t.wheel=setTimeout(r,150),t.zoom("mouse",b(q(S(n,i),t.mouse[0],t.mouse[1]),t.extent,j))}function r(){t.wheel=null,t.end()}}function W(){if(!w&&T.apply(this,arguments)){var n=A(this,arguments,!0),e=i(t.view).on("mousemove.zoom",f,!0).on("mouseup.zoom",l,!0),r=o(this),u=t.clientX,a=t.clientY;s(t.view),y(),n.mouse=[r,this.__zoom.invert(r)],h(this),n.start()}function f(){if(v(),!n.moved){var i=t.clientX-u,e=t.clientY-a;n.moved=i*i+e*e>I}n.zoom("mouse",b(q(n.that.__zoom,n.mouse[0]=o(n.that),n.mouse[1]),n.extent,j))}function l(){e.on("mousemove.zoom mouseup.zoom",null),c(t.view,n.moved),v(),n.end()}}function C(){if(T.apply(this,arguments)){var n=this.__zoom,e=o(this),r=n.invert(e),u=n.k*(t.shiftKey?.5:2),h=b(q(S(n,u),e,r),M.apply(this,arguments),j);v(),B>0?i(this).transition().duration(B).call(K,h,e):i(this).call(P.transform,h)}}function F(){if(T.apply(this,arguments)){var n,o,i,r,u=t.touches,s=u.length,c=A(this,arguments,t.changedTouches.length===s);for(y(),o=0;o<s;++o)i=u[o],r=[r=e(this,u,i.identifier),this.__zoom.invert(r),i.identifier],c.touch0?c.touch1||c.touch0[2]===r[2]||(c.touch1=r,c.taps=0):(c.touch0=r,n=!0,c.taps=1+!!p);p&&(p=clearTimeout(p)),n&&(c.taps<2&&(p=setTimeout((function(){p=null}),500)),h(this),c.start())}}function J(){if(this.__zooming){var n,o,i,r,u=A(this,arguments),h=t.changedTouches,s=h.length;for(v(),p&&(p=clearTimeout(p)),u.taps=0,n=0;n<s;++n)o=h[n],i=e(this,h,o.identifier),u.touch0&&u.touch0[2]===o.identifier?u.touch0[0]=i:u.touch1&&u.touch1[2]===o.identifier&&(u.touch1[0]=i);if(o=u.that.__zoom,u.touch1){var c=u.touch0[0],a=u.touch0[1],f=u.touch1[0],l=u.touch1[1],m=(m=f[0]-c[0])*m+(m=f[1]-c[1])*m,y=(y=l[0]-a[0])*y+(y=l[1]-a[1])*y;o=S(o,Math.sqrt(m/y)),i=[(c[0]+f[0])/2,(c[1]+f[1])/2],r=[(a[0]+l[0])/2,(a[1]+l[1])/2]}else{if(!u.touch0)return;i=u.touch0[0],r=u.touch0[1]}u.zoom("touch",b(q(o,i,r),u.extent,j))}}function L(){if(this.__zooming){var n,o,e=A(this,arguments),r=t.changedTouches,u=r.length;for(y(),w&&clearTimeout(w),w=setTimeout((function(){w=null}),500),n=0;n<u;++n)o=r[n],e.touch0&&e.touch0[2]===o.identifier?delete e.touch0:e.touch1&&e.touch1[2]===o.identifier&&delete e.touch1;if(e.touch1&&!e.touch0&&(e.touch0=e.touch1,delete e.touch1),e.touch0)e.touch0[1]=this.__zoom.invert(e.touch0[0]);else if(e.end(),2===e.taps){var h=i(this).on("dblclick.zoom");h&&h.apply(this,arguments)}}}return P.transform=function(t,n,o){var i=t.selection?t.selection():t;i.property("__zoom",_),t!==i?K(t,n,o):i.interrupt().each((function(){A(this,arguments).start().zoom(null,"function"==typeof n?n.apply(this,arguments):n).end()}))},P.scaleBy=function(t,n,o){P.scaleTo(t,(function(){var t=this.__zoom.k,o="function"==typeof n?n.apply(this,arguments):n;return t*o}),o)},P.scaleTo=function(t,n,o){P.transform(t,(function(){var t=M.apply(this,arguments),i=this.__zoom,e=null==o?G(t):"function"==typeof o?o.apply(this,arguments):o,r=i.invert(e),u="function"==typeof n?n.apply(this,arguments):n;return b(q(S(i,u),e,r),t,j)}),o)},P.translateBy=function(t,n,o){P.transform(t,(function(){return b(this.__zoom.translate("function"==typeof n?n.apply(this,arguments):n,"function"==typeof o?o.apply(this,arguments):o),M.apply(this,arguments),j)}))},P.translateTo=function(t,n,o,i){P.transform(t,(function(){var t=M.apply(this,arguments),e=this.__zoom,r=null==i?G(t):"function"==typeof i?i.apply(this,arguments):i;return b(m.translate(r[0],r[1]).scale(e.k).translate("function"==typeof n?-n.apply(this,arguments):-n,"function"==typeof o?-o.apply(this,arguments):-o),t,j)}),i)},H.prototype={start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,n){return this.mouse&&"mouse"!==t&&(this.mouse[1]=n.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=n.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=n.invert(this.touch1[0])),this.that.__zoom=n,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){n(new f(P,t,this.that.__zoom),D.apply,D,[t,this.that,this.args])}},P.wheelDelta=function(t){return arguments.length?(Y="function"==typeof t?t:a(+t),P):Y},P.filter=function(t){return arguments.length?(T="function"==typeof t?t:a(!!t),P):T},P.touchable=function(t){return arguments.length?(X="function"==typeof t?t:a(!!t),P):X},P.extent=function(t){return arguments.length?(M="function"==typeof t?t:a([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),P):M},P.scaleExtent=function(t){return arguments.length?(V[0]=+t[0],V[1]=+t[1],P):[V[0],V[1]]},P.translateExtent=function(t){return arguments.length?(j[0][0]=+t[0][0],j[1][0]=+t[1][0],j[0][1]=+t[0][1],j[1][1]=+t[1][1],P):[[j[0][0],j[0][1]],[j[1][0],j[1][1]]]},P.constrain=function(t){return arguments.length?(b=t,P):b},P.duration=function(t){return arguments.length?(B=+t,P):B},P.interpolate=function(t){return arguments.length?(E=t,P):E},P.on=function(){var t=D.on.apply(D,arguments);return t===D?P:t},P.clickDistance=function(t){return arguments.length?(I=(t=+t)*t,P):Math.sqrt(I)},P}p.prototype=l.prototype;export{w as zoom,m as zoomIdentity,p as zoomTransform};
//# sourceMappingURL=d3-zoom.js.map
